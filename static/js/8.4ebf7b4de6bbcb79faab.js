webpackJsonp([8,19],{CHl0:function(t,e){},IkR7:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"en":{"私信":"Direct Messages","加载更多":"Load more"}}'),delete t.options._Ctor}},Rf88:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("XyMi"),i={props:{thread:{type:Object,default:function(){return{id:null,unread_count:0,latest_message:{id:null,body:"",created_at:""},participant:{id:null,name:"",type:"",avatar_url:"",introduction:"",follower_count:0,following_count:0,following:!1},created_at:"",updated_at:""}}}},computed:{unreadCount:function(){return this.thread.unread_count},latestMessage:function(){return this.thread.latest_message},participant:function(){return this.thread.participant}}},s={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flex p-12"},[n("my-avatar",{staticClass:"flex-none",attrs:{"avatar-url":t.participant.avatar_url}}),t._v(" "),n("div",{staticClass:"flex-auto ml1"},[n("p",{staticClass:"flex-1 m0 f-15 bold black",domProps:{textContent:t._s(t.participant.name)}}),t._v(" "),n("p",{staticClass:"mt-4 m0 f-13 black-65 ellipsis-1",domProps:{textContent:t._s(t.latestMessage.body)}}),t._v(" "),n("p",{staticClass:"mt-4 m0 f-12 black-65",domProps:{textContent:t._s(t.thread.updated_at)}})]),t._v(" "),n("el-badge",{attrs:{value:t.unreadCount,hidden:!t.unreadCount,max:99}})],1)},staticRenderFns:[]};var r=function(t){n("r6V5")},o={components:{ThreadItem:Object(a.a)(i,s,!1,r,"data-v-730d86f5",null).exports,Chat:n("hq8F").default},data:function(){return{currentPage:0,currentThreadId:null,initing:!0,loading:!1,error:!1,nomore:!1}},computed:{threads:function(){return this.$store.getters.threads},busy:function(){return this.initing||this.loading||this.nomore||this.error},nodata:function(){return!this.initing&&!this.loading&&!this.threads.length}},created:function(){var t=this;this.getThreads().then(function(){t.initing=!1}).catch(function(){t.initing=!1,t.error=!0})},methods:{getThreads:function(){var t=this;return this.$store.dispatch("getThreads",this.currentPage+1).then(function(e){t.currentPage=e.current_page,t.nomore=e.total_pages<=e.current_page})},onLoadMore:function(){var t=this;this.loading=!0,this.getThreads().then(function(){t.loading=!1}).catch(function(){t.loading=!1,t.error=!0})},onReload:function(){this.error=!1}}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"main-container"},[n("div",{staticClass:"card"},[n("h1",{directives:[{name:"t",rawName:"v-t",value:"私信",expression:"'私信'"}],staticClass:"m0 p2 f-16 bold border-bottom"}),t._v(" "),n("div",{staticClass:"chatbox-container"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.initing,expression:"initing"}],staticClass:"thread-list"},[t.nodata?n("my-empty"):t._e(),t._v(" "),t._l(t.threads,function(e){return n("thread-item",{key:e.id,staticClass:"thread-list-item",class:{"is-active":e.id==t.currentThreadId},attrs:{thread:e},nativeOn:{click:function(n){t.currentThreadId=e.id}}})}),t._v(" "),n("my-loader",{attrs:{loading:t.loading,error:t.error,"btn-text":t.$t("g.reload"),"on-reload":t.onReload}}),t._v(" "),t.busy?t._e():n("el-button",{staticClass:"w-100 mt-12 center",attrs:{type:"text",size:"mini"},on:{click:t.onLoadMore}},[t._v(t._s(t.$t("加载更多")))])],2),t._v(" "),t.currentThreadId?n("chat",{staticClass:"chat",attrs:{"thread-id":t.currentThreadId}}):t._e()],1)])])},staticRenderFns:[]};var d=function(t){n("CHl0")},u=Object(a.a)(o,c,!1,d,"data-v-43ba28c0",null),l=n("IkR7");l&&l.__esModule&&(l=l.default),"function"==typeof l&&l(u);e.default=u.exports},W8jv:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"en":{"查看更多":"Load more","发送":"Send","按下Enter键发送，最多300字":"Type Enter to send, 300 characters at most"}}'),delete t.options._Ctor}},hq8F:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("XyMi"),i=n("woOf"),s=n.n(i),r={props:{message:{type:Object,default:function(){return{}}},participant:{type:Object,default:function(){return{}}}},computed:{currentUser:function(){return this.$store.getters.userInfo},isSelf:function(){return this.message.user_id===this.currentUser.id}}},o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"message-item",class:{"is-self":t.isSelf}},[n("router-link",{attrs:{to:"/profile?uid="+t.message.user_id}},[n("my-avatar",{staticClass:"message-item__avatar",attrs:{"avatar-url":t.isSelf?t.currentUser.avatar_url:t.participant.avatar_url}})],1),t._v(" "),n("div",{staticClass:"message-item__text"},[t._v(t._s(t.message.body))])],1)},staticRenderFns:[]};var c=function(t){n("nSRp")},d=Object(a.a)(r,o,!1,c,"data-v-8c76e866",null).exports,u=n("oqQY"),l=n.n(u),h=n("0xDb"),f={components:{MessageItem:d},filters:{time:function(t){var e=l()(t);return l()(Object(h.a)()).isBefore(e)?e.format("HH:mm:ss"):e.format("M-D HH:mm:ss")}},props:{threadId:{type:Number,required:!0}},data:function(){return{textarea:"",currentPage:0,initing:!0,loading:!1,nomore:!1,sending:!1}},computed:{messages:function(){return this.$store.getters.messages},participant:function(){return this.$store.getters.participant}},watch:{threadId:function(){this.init()}},created:function(){this.init()},methods:{init:function(){var t=this;s()(this.$data,this.$options.data()),this.getMessages().then(function(){t.initing=!1,t.scrollToBottom()}).catch(function(){t.initing=!1})},onSend:function(){var t=this,e=this.textarea,n=this.threadId;!this.sending&&e.trim()&&(this.sending=!0,this.$store.dispatch("postMessageByThreadId",{id:n,body:e}).then(function(){t.textarea="",t.sending=!1,t.scrollToBottom()}).catch(function(){t.sending=!1}))},getMessages:function(){var t=this;return this.$store.dispatch("getMessagesByThreadId",{id:this.threadId,page:this.currentPage+1}).then(function(e){t.currentPage=e.current_page,t.nomore=e.total_pages<=e.current_page})},onLoadMore:function(){var t=this;this.loading=!0,this.getMessages().then(function(){t.loading=!1}).catch(function(){t.loading=!1})},scrollToBottom:function(){var t=this.$refs.messageBox;t.scrollTop=t.scrollHeight-t.clientHeight}}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.initing,expression:"initing"}],staticClass:"card"},[n("div",{ref:"messageBox",staticClass:"message-box"},[t.initing||t.nomore?t._e():n("div",{staticClass:"center pt1"},[t.loading?n("i",{staticClass:"el-icon-loading"}):n("el-button",{attrs:{type:"text",size:"mini"},on:{click:t.onLoadMore}},[t._v(t._s(t.$t("查看更多")))])],1),t._v(" "),n("ul",{staticClass:"list-reset"},t._l(t.messages,function(e){return n("li",{key:e.id,staticClass:"message-item"},[n("fieldset",{staticClass:"message-item__time"},[n("legend",[t._v(t._s(t._f("time")(e.created_at)))])]),t._v(" "),n("message-item",{attrs:{message:e,participant:t.participant}})],1)}))]),t._v(" "),n("el-input",{ref:"input",staticClass:"chat-input",attrs:{placeholder:t.$t("按下Enter键发送，最多300字"),maxlength:"300",size:"small"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.onSend(e):null}},model:{value:t.textarea,callback:function(e){t.textarea=e},expression:"textarea"}},[n("el-button",{attrs:{slot:"append",loading:t.sending,type:"primary"},on:{click:t.onSend},slot:"append"},[t._v(t._s(t.$t("发送")))])],1)],1)},staticRenderFns:[]};var g=function(t){n("j5H8")},m=Object(a.a)(f,p,!1,g,"data-v-6b1f3633",null),_=n("W8jv");_&&_.__esModule&&(_=_.default),"function"==typeof _&&_(m);e.default=m.exports},j5H8:function(t,e){},nSRp:function(t,e){},r6V5:function(t,e){}});
//# sourceMappingURL=8.4ebf7b4de6bbcb79faab.js.map