webpackJsonp([19],{W8jv:function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"en":{"查看更多":"Load more","发送":"Send","按下Enter键发送，最多300字":"Type Enter to send, 300 characters at most"}}'),delete t.options._Ctor}},hq8F:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("XyMi"),i=n("woOf"),a=n.n(i),r={props:{message:{type:Object,default:function(){return{}}},participant:{type:Object,default:function(){return{}}}},computed:{currentUser:function(){return this.$store.getters.userInfo},isSelf:function(){return this.message.user_id===this.currentUser.id}}},o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"message-item",class:{"is-self":t.isSelf}},[n("router-link",{attrs:{to:"/profile?uid="+t.message.user_id}},[n("my-avatar",{staticClass:"message-item__avatar",attrs:{"avatar-url":t.isSelf?t.currentUser.avatar_url:t.participant.avatar_url}})],1),t._v(" "),n("div",{staticClass:"message-item__text"},[t._v(t._s(t.message.body))])],1)},staticRenderFns:[]};var c=function(t){n("nSRp")},u=Object(s.a)(r,o,!1,c,"data-v-8c76e866",null).exports,l=n("oqQY"),d=n.n(l),g=n("0xDb"),p={components:{MessageItem:u},filters:{time:function(t){var e=d()(t);return d()(Object(g.a)()).isBefore(e)?e.format("HH:mm:ss"):e.format("M-D HH:mm:ss")}},props:{threadId:{type:Number,required:!0}},data:function(){return{textarea:"",currentPage:0,initing:!0,loading:!1,nomore:!1,sending:!1}},computed:{messages:function(){return this.$store.getters.messages},participant:function(){return this.$store.getters.participant}},watch:{threadId:function(){this.init()}},created:function(){this.init()},methods:{init:function(){var t=this;a()(this.$data,this.$options.data()),this.getMessages().then(function(){t.initing=!1,t.scrollToBottom()}).catch(function(){t.initing=!1})},onSend:function(){var t=this,e=this.textarea,n=this.threadId;!this.sending&&e.trim()&&(this.sending=!0,this.$store.dispatch("postMessageByThreadId",{id:n,body:e}).then(function(){t.textarea="",t.sending=!1,t.scrollToBottom()}).catch(function(){t.sending=!1}))},getMessages:function(){var t=this;return this.$store.dispatch("getMessagesByThreadId",{id:this.threadId,page:this.currentPage+1}).then(function(e){t.currentPage=e.current_page,t.nomore=e.total_pages<=e.current_page})},onLoadMore:function(){var t=this;this.loading=!0,this.getMessages().then(function(){t.loading=!1}).catch(function(){t.loading=!1})},scrollToBottom:function(){var t=this.$refs.messageBox;t.scrollTop=t.scrollHeight-t.clientHeight}}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.initing,expression:"initing"}],staticClass:"card"},[n("div",{ref:"messageBox",staticClass:"message-box"},[t.initing||t.nomore?t._e():n("div",{staticClass:"center pt1"},[t.loading?n("i",{staticClass:"el-icon-loading"}):n("el-button",{attrs:{type:"text",size:"mini"},on:{click:t.onLoadMore}},[t._v(t._s(t.$t("查看更多")))])],1),t._v(" "),n("ul",{staticClass:"list-reset"},t._l(t.messages,function(e){return n("li",{key:e.id,staticClass:"message-item"},[n("fieldset",{staticClass:"message-item__time"},[n("legend",[t._v(t._s(t._f("time")(e.created_at)))])]),t._v(" "),n("message-item",{attrs:{message:e,participant:t.participant}})],1)}))]),t._v(" "),n("el-input",{ref:"input",staticClass:"chat-input",attrs:{placeholder:t.$t("按下Enter键发送，最多300字"),maxlength:"300",size:"small"},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.onSend(e):null}},model:{value:t.textarea,callback:function(e){t.textarea=e},expression:"textarea"}},[n("el-button",{attrs:{slot:"append",loading:t.sending,type:"primary"},on:{click:t.onSend},slot:"append"},[t._v(t._s(t.$t("发送")))])],1)],1)},staticRenderFns:[]};var m=function(t){n("j5H8")},h=Object(s.a)(p,f,!1,m,"data-v-6b1f3633",null),_=n("W8jv");_&&_.__esModule&&(_=_.default),"function"==typeof _&&_(h);e.default=h.exports},j5H8:function(t,e){},nSRp:function(t,e){}});
//# sourceMappingURL=19.45362571b4348784fb29.js.map